# イベント関数

<details>

<summary>function onloaded()</summary>

Luaファイルが読み込まれた後に実行されるイベント関数。

Luaタグで指定したファイルはゲーム画面に移る直後に読み込まれる。

### 90%くらい使う。

```lua
function onloaded()
  SCREENMAN:SystemMessage("onloaded")
end
```

</details>

<details>

<summary>function start()</summary>

開始を押して曲が始まる1フレームだけ実行されるイベント関数。

### 90%くらい使う。

```lua
function start()
  SCREENMAN:SystemMessage("start")
end
```

</details>


<details>

<summary>function update()</summary>

楽曲再生中に毎フレーム実行されるイベント関数。

サンプルにもある通り、SongBeatを取得するときに必ず使う。

ていうかギミック譜面のほとんどはあまり避けられないと思う。

```lua
function update()
  local currentBeat = GAMESTATE:GetSongBeat()
  SCREENMAN:SystemMessage(currentBeat)
end
```
</details>

<details>

<summary>function finish()</summary>

楽曲の再生終了時に実行されるイベント関数。

> [!WARNING]
> 稀に実行できないバージョンがある。

```lua
function finish()
  SCREENMAN:SystemMessage("finish")
end
```
</details>

<details>

<summary>function ondestroy()</summary>

ゲーム画面終了時に実行されるイベント関数。

読み込みリセットはアプリ側がやってくれる為、使用頻度はそこまで高くない。

> [!IMPORTANT]
> ```lua
> require ”(ファイル名)” 
> ```
> を実行した場合、
> ```lua
> package.loaded[”(ファイル名)”] = nil
> _G[”(ファイル名)”] = nil
> ```
> をこの関数内で実行するとファイルの競合がなくなるので、なるべく書いて欲しい。

```lua
function ondestroy()
  print("lua destroy")
end
```
</details>

<details>

<summary>function onHitNote(id, lane, noteType, judgeType, isAttack)</summary>

ノーツが判定にヒットした時に実行されるイベント関数。
  <details>
  <summary>各引数について</summary>

  |引数|説明|
  |-|-|
  |id|0から始まるノーツ番号|
  |lane|0から数えた左からのレーン数|
  |noteType|ノーツの種類の値|
  |judgeType|判定の種類の値|
  |isAttack|アタックノーツの真偽値|
  </details>
  <details>
  <summary>noteTypeの値について</summary>

  |番号|ノーツの種類|
  |-|-|
  |0|(これって必要？)|
  |1|タップノーツ|
  |2|ロング開始|
  |3|ロング中継|
  |4|ロング終端|
  |5|ファジーノーツ|
  |6|ファジーロング開始|
  |7|ファジーロング中継|
  |8|ファジーロング終端|
  </details>
  <details>
  <summary>judgeTypeの値について</summary>

  |番号|判定の種類|
  |-|-|
  |0|Brilliant|
  |1|Great|
  |2|Fast|
  |3|Slow|
  |4|Bad|
  |5|Missed(onHitNoteでは取得されない)|

  **取得されないのになんで5があるんだよ**
  </details>


```lua
function onHitNote(id, lane, noteType, judgeType, isAttack)
  local src={id,lane,noteType,judgeType,isAttack}
  local dst=table.concat(src,",")
  print(dst)
end
```
</details>
<details>

<summary>function onMissedNote(id, lane, noteType)</summary>

ミスの判定時に実行されるイベント関数。
  <details>
  <summary>各引数について</summary>

  |引数|説明|
  |-|-|
  |id|0から始まるノーツ番号|
  |lane|0から数えた左からのレーン数|
  |noteType|ノーツの種類の値|

  **何故ここにisAttackがないのか**
  ~~要望出してないから~~
  </details>
  <details>
  <summary>noteTypeの値について</summary>

  |番号|ノーツの種類|
  |-|-|
  |0|(**マジでこれって必要？**)|
  |1|タップノーツ|
  |2|ロング開始|
  |3|ロング中継|
  |4|ロング終端|
  |5|ファジーノーツ|
  |6|ファジーロング開始|
  |7|ファジーロング中継|
  |8|ファジーロング終端|
  </details>

```lua
function onMissedNote(id, lane, noteType)
  local src={id,lane,noteType}
  local dst=table.concat(src,",")
  print(dst)
end
```
</details>

<details>

<summary>function onSpawnNote(noteController)</summary>

ノーツが生成された時に呼ばれるイベント関数。

引数には生成したNoteControllerクラスの参照が取得される。
  <details>
  <summary>NoteControllerクラスについて</summary>

    <details>
    <summary>取得のみ可能なプロパティ</summary>
    -
    |プロパティ名|型|説明|
    |---|---|---|
    |IsReleased|bool|アクティブ状態から解放したか|
    |NoteIndex|int|0からのノーツ番号|
    |Lane|int|0数えで左側からのレーン数|
    |IsAttack|bool|アタックノーツか|
    |IsMissed|bool|ミスしたか|
    |NoteType|NoteType|ノーツの種類|
    |PosX|float|X座標|
    |JustTime|double|ジャストの時間(秒)|
    |JustBeat|double|ジャストの拍数(スクロールタグ計算済の値)|
    </details>

  </details>


```lua

```
</details>





















<details>

<summary>a</summary>
あ

```lua

```
</details>